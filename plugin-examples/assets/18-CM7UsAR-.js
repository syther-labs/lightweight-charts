var x=Object.defineProperty;var f=(o,e,t)=>e in o?x(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var i=(o,e,t)=>f(o,typeof e!="symbol"?e+"":e,t);import{z as m,L as v,K as C}from"./lightweight-charts.production-DgIFtYUu.js";import{g as b}from"./sample-data-x_8-FZm1.js";import{e as a,P}from"./plugin-base-CSm8qb-O.js";import{a as l}from"./positions-t2UKkghX.js";class V{constructor(e,t,s){i(this,"_p1");i(this,"_p2");i(this,"_fillColor");this._p1=e,this._p2=t,this._fillColor=s}draw(e){e.useBitmapCoordinateSpace(t=>{if(this._p1.x===null||this._p1.y===null||this._p2.x===null||this._p2.y===null)return;const s=t.context,r=l(this._p1.x,this._p2.x,t.horizontalPixelRatio),n=l(this._p1.y,this._p2.y,t.verticalPixelRatio);s.fillStyle=this._fillColor,s.fillRect(r.position,n.position,r.length,n.length)})}}class R{constructor(e){i(this,"_source");i(this,"_p1",{x:null,y:null});i(this,"_p2",{x:null,y:null});this._source=e}update(){const e=this._source.series,t=e.priceToCoordinate(this._source._p1.price),s=e.priceToCoordinate(this._source._p2.price),r=this._source.chart.timeScale(),n=r.timeToCoordinate(this._source._p1.time),g=r.timeToCoordinate(this._source._p2.time);this._p1={x:n,y:t},this._p2={x:g,y:s}}renderer(){return new V(this._p1,this._p2,this._source._options.fillColor)}}class y{constructor(e,t,s,r){i(this,"_p1");i(this,"_p2");i(this,"_fillColor");i(this,"_vertical",!1);this._p1=e,this._p2=t,this._fillColor=s,this._vertical=r}draw(e){e.useBitmapCoordinateSpace(t=>{if(this._p1===null||this._p2===null)return;const s=t.context;s.globalAlpha=.5;const r=l(this._p1,this._p2,this._vertical?t.verticalPixelRatio:t.horizontalPixelRatio);s.fillStyle=this._fillColor,this._vertical?s.fillRect(0,r.position,15,r.length):s.fillRect(r.position,0,r.length,15)})}}class _{constructor(e,t){i(this,"_source");i(this,"_p1",null);i(this,"_p2",null);i(this,"_vertical",!1);this._source=e,this._vertical=t}update(){[this._p1,this._p2]=this.getPoints()}renderer(){return new y(this._p1,this._p2,this._source._options.fillColor,this._vertical)}zOrder(){return"bottom"}}class A extends _{getPoints(){const e=this._source.series,t=e.priceToCoordinate(this._source._p1.price),s=e.priceToCoordinate(this._source._p2.price);return[t,s]}}class T extends _{getPoints(){const e=this._source.chart.timeScale(),t=e.timeToCoordinate(this._source._p1.time),s=e.timeToCoordinate(this._source._p2.time);return[t,s]}}class p{constructor(e,t){i(this,"_source");i(this,"_p");i(this,"_pos",null);this._source=e,this._p=t}coordinate(){return this._pos??-1}visible(){return this._source._options.showLabels}tickVisible(){return this._source._options.showLabels}textColor(){return this._source._options.labelTextColor}backColor(){return this._source._options.labelColor}movePoint(e){this._p=e,this.update()}}class c extends p{update(){const e=this._source.chart.timeScale();this._pos=e.timeToCoordinate(this._p.time)}text(){return this._source._options.timeLabelFormatter(this._p.time)}}class h extends p{update(){const e=this._source.series;this._pos=e.priceToCoordinate(this._p.price)}text(){return this._source._options.priceLabelFormatter(this._p.price)}}const D={fillColor:"rgba(200, 50, 100, 0.75)",previewFillColor:"rgba(200, 50, 100, 0.25)",labelColor:"rgba(200, 50, 100, 1)",labelTextColor:"white",showLabels:!0,priceLabelFormatter:o=>o.toFixed(2),timeLabelFormatter:o=>typeof o=="string"?o:(m(o)?new Date(o.year,o.month,o.day):new Date(o*1e3)).toLocaleDateString()};class u extends P{constructor(t,s,r={}){super();i(this,"_options");i(this,"_p1");i(this,"_p2");i(this,"_paneViews");i(this,"_timeAxisViews");i(this,"_priceAxisViews");i(this,"_priceAxisPaneViews");i(this,"_timeAxisPaneViews");this._p1=t,this._p2=s,this._options={...D,...r},this._paneViews=[new R(this)],this._timeAxisViews=[new c(this,t),new c(this,s)],this._priceAxisViews=[new h(this,t),new h(this,s)],this._priceAxisPaneViews=[new A(this,!0)],this._timeAxisPaneViews=[new T(this,!1)]}updateAllViews(){this._paneViews.forEach(t=>t.update()),this._timeAxisViews.forEach(t=>t.update()),this._priceAxisViews.forEach(t=>t.update()),this._priceAxisPaneViews.forEach(t=>t.update()),this._timeAxisPaneViews.forEach(t=>t.update())}priceAxisViews(){return this._priceAxisViews}timeAxisViews(){return this._timeAxisViews}paneViews(){return this._paneViews}priceAxisPaneViews(){return this._priceAxisPaneViews}timeAxisPaneViews(){return this._timeAxisPaneViews}applyOptions(t){this._options={...this._options,...t},this.requestUpdate()}}class L extends u{constructor(e,t,s={}){super(e,t,s),this._options.fillColor=this._options.previewFillColor}updateEndPoint(e){this._p2=e,this._paneViews[0].update(),this._timeAxisViews[1].movePoint(e),this._priceAxisViews[1].movePoint(e),this.requestUpdate()}}class S{constructor(e,t,s,r){i(this,"_chart");i(this,"_series");i(this,"_drawingsToolbarContainer");i(this,"_defaultOptions");i(this,"_rectangles");i(this,"_previewRectangle");i(this,"_points",[]);i(this,"_drawing",!1);i(this,"_toolbarButton");i(this,"_clickHandler",e=>this._onClick(e));i(this,"_moveHandler",e=>this._onMouseMove(e));this._chart=e,this._series=t,this._drawingsToolbarContainer=s,this._addToolbarButton(),this._defaultOptions=r,this._rectangles=[],this._chart.subscribeClick(this._clickHandler),this._chart.subscribeCrosshairMove(this._moveHandler)}remove(){this.stopDrawing(),this._chart&&(this._chart.unsubscribeClick(this._clickHandler),this._chart.unsubscribeCrosshairMove(this._moveHandler)),this._rectangles.forEach(e=>{this._removeRectangle(e)}),this._rectangles=[],this._removePreviewRectangle(),this._chart=void 0,this._series=void 0,this._drawingsToolbarContainer=void 0}startDrawing(){this._drawing=!0,this._points=[],this._toolbarButton&&(this._toolbarButton.style.fill="rgb(100, 150, 250)")}stopDrawing(){this._drawing=!1,this._points=[],this._toolbarButton&&(this._toolbarButton.style.fill="rgb(0, 0, 0)")}isDrawing(){return this._drawing}_onClick(e){if(!this._drawing||!e.point||!e.time||!this._series)return;const t=this._series.coordinateToPrice(e.point.y);t!==null&&this._addPoint({time:e.time,price:t})}_onMouseMove(e){if(!this._drawing||!e.point||!e.time||!this._series)return;const t=this._series.coordinateToPrice(e.point.y);t!==null&&this._previewRectangle&&this._previewRectangle.updateEndPoint({time:e.time,price:t})}_addPoint(e){this._points.push(e),this._points.length>=2&&(this._addNewRectangle(this._points[0],this._points[1]),this.stopDrawing(),this._removePreviewRectangle()),this._points.length===1&&this._addPreviewRectangle(this._points[0])}_addNewRectangle(e,t){const s=new u(e,t,{...this._defaultOptions});this._rectangles.push(s),a(this._series).attachPrimitive(s)}_removeRectangle(e){a(this._series).detachPrimitive(e)}_addPreviewRectangle(e){this._previewRectangle=new L(e,e,{...this._defaultOptions}),a(this._series).attachPrimitive(this._previewRectangle)}_removePreviewRectangle(){this._previewRectangle&&(a(this._series).detachPrimitive(this._previewRectangle),this._previewRectangle=void 0)}_addToolbarButton(){if(!this._drawingsToolbarContainer)return;const e=document.createElement("div");e.style.width="20px",e.style.height="20px",e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M315.4 15.5C309.7 5.9 299.2 0 288 0s-21.7 5.9-27.4 15.5l-96 160c-5.9 9.9-6.1 22.2-.4 32.2s16.3 16.2 27.8 16.2H384c11.5 0 22.2-6.2 27.8-16.2s5.5-22.3-.4-32.2l-96-160zM288 312V456c0 22.1 17.9 40 40 40H472c22.1 0 40-17.9 40-40V312c0-22.1-17.9-40-40-40H328c-22.1 0-40 17.9-40 40zM128 512a128 128 0 1 0 0-256 128 128 0 1 0 0 256z"/></svg>',e.addEventListener("click",()=>{this.isDrawing()?this.stopDrawing():this.startDrawing()}),this._drawingsToolbarContainer.appendChild(e),this._toolbarButton=e;const t=document.createElement("input");t.type="color",t.value="#C83264",t.style.width="24px",t.style.height="20px",t.style.border="none",t.style.padding="0px",t.style.backgroundColor="transparent",t.addEventListener("change",()=>{const s=t.value;this._defaultOptions.fillColor=s+"CC",this._defaultOptions.previewFillColor=s+"77",this._defaultOptions.labelColor=s}),this._drawingsToolbarContainer.appendChild(t)}}const d=window.chart=v("chart",{autoSize:!0}),w=d.addSeries(C),B=b();w.setData(B);new S(d,w,document.querySelector("#toolbar"),{showLabels:!1});
